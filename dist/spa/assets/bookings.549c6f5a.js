import{aQ as E,at as B,a_ as T,c as u,w as N}from"./index.88f48d4d.js";import{u as m,a as g}from"./useApi.f2502392.js";const l={"-1":"grey-8",0:"orange-8",1:"primary",2:"green-8",3:"lime-8"},h=new Date().getMonth()+1,b=new Date().getFullYear(),F=E("bookings",()=>{const{g:t}=B(),y=T(),f=()=>{t.arenaDateTime=new Date().toLocaleString("sv",{timeZone:t.arenaTimezone})};f(),t.arenaDate=u(()=>t.arenaDateTime.slice(0,10)),t.arenaTime=u(()=>t.arenaDateTime.slice(11,16)),t.timeFrame=u(()=>t.games.reduce((a,e)=>{var o,r;const s=e.calendar[t.selectedDate];return s&&((o=a[0])!=null||(a[0]=s.at(0).start),(r=a[1])!=null||(a[1]=s.at(-1).start),a[0]=a[0]>s.at(0).start?s.at(0).start:a[0],a[1]=a[1]<s.at(-1).start?s.at(-1).start:a[1]),a},[])),t.gameGroups=u(()=>{const a=[{value:"all",label:"\u0412\u0441\u0435"}];return t.games.forEach(e=>{const s=e.game_group;a.push({value:s.id,label:s.name})}),[...new Map(a.map(e=>[e.value,e])).values()]}),N(()=>t.gameGroups,()=>{t.selectedGameGroups.length===1&&t.selectedGameGroups.includes("all")&&t.gameGroups.forEach(a=>{a.value!=="all"&&t.selectedGameGroups.push(a.value)})});const _=a=>{a.date=a.game_session.start.slice(0,10),a.time=a.game_session.start.slice(11,16),a.end=a.game_session.end.slice(11,16)},w=a=>{_(a),a.order.closed&&(a.status=2),a.statusColor=l[a.status],a.payStatus=a.order.pay_info.paid>0?a.order.pay_info.left>0?3:a.order.closed?2:1:0,a.payStatusColor=l[a.payStatus],a.duration=a.arena_game.duration,a.gameName=a.arena_game.name,a.gameId=a.arena_game.id,a.pqd=a.arena_game.players_quantity_dependency},k=(a,e)=>{_(a),a.statusColor=l[a.status.value],a.payStatus=a.payment>0?a.amount_with_discount-a.payment>0?3:a.status.value===2?2:1:0,a.payStatusColor=l[a.payStatus],a.duration=e.duration,a.gameName=e.name,a.gameId=e.id,a.pqd=e.players_quantity_dependency},S=async()=>{const a=`/management/arena/${t.selectedArenaId}/timeline?date=${t.selectedDate}`;t.games=(await m(a)).data||[],t.games.forEach(e=>{e.groups=[],e.game_group||(e.game_group={}),e.bookings||(e.bookings=[]),e.bookings.forEach(r=>k(r,e));const o=!e.calendar[t.selectedDate].some(r=>r.available_for_booking>0);e.empty=!e.bookings.length&&o?1:-1}),t.games.sort((e,s)=>e.empty-s.empty||s.timeline_style-e.timeline_style||e.name.localeCompare(s.name))},p=async()=>(await m("/management/user/info?group_by=countries")).data||[],I=async()=>{var s;const e=(s=(await p()).arenas.find(o=>o.id===t.selectedCountry.id))==null?void 0:s.cities.find(o=>o.id===t.selectedCity.id);return e?e.arenas:null},C=async()=>{if(localStorage.getItem("city")&&localStorage.getItem("country")&&localStorage.getItem("selected-arena")&&localStorage.getItem("selected-arena-id")&&t.selectedArena)return;(await p()).arenas.forEach(e=>{e.name==="\u0420\u043E\u0441\u0441\u0438\u044F"&&(t.selectedCountry={id:e.id,name:e.name,cities:e.cities},t.selectedCity={id:e.cities[1].id,name:e.cities[1].name},t.selectedArena={id:e.cities[1].arenas[0].id,name:e.cities[1].arenas[0].name,title:e.cities[1].arenas[0].title,address:e.cities[1].arenas[0].address},t.selectedArenaId=e.cities[1].arenas[0].id,localStorage.setItem("country",JSON.stringify(t.selectedCountry)),localStorage.setItem("city",JSON.stringify(t.selectedCity)),localStorage.setItem("selected-arena",JSON.stringify(t.selectedArena)),localStorage.setItem("selected-arena-id",JSON.stringify(t.selectedArenaId)))})},A=async a=>{const{data:e}=await g(`/site/arena/${a}/awesome`);return e},D=async a=>{const{data:e}=await g(`/site/arenagame/${a}`);return e},G=async(a,e)=>{let s=null,o={};Object.assign(o,e),h===12?s=await g(`/site/arenagame/${a}?months=${1}&year=${b+1}`):s=await g(`/site/arenagame/${a}?months=${h+1}&year=${b}`);for(const i of Object.keys(s.data.calendar))if(Object.prototype.hasOwnProperty.call(o,i)){const $=o[i].map(d=>d.max_players);s.data.calendar[i].map(d=>d.max_players).forEach((d,O)=>{$.includes(d)||o[i].push(s.data.calendar[i][O])})}else o[i]=[...s.data.calendar[i]];const r=Object.keys(s.data.calendar).pop(),n=new Date(r);return{dataCopy:o,dateObject:n}},c=async a=>{const{data:e}=await m(`/management/booking/${a}`);return e&&w(e),e};return{setTime:f,getArenaGames:S,getBookingById:c,getBookings:async()=>{const{data:a}=await m(`/management/arena/${t.selectedArenaId}/bookings`);a==null||a.forEach(w),t.bookings=a||[]},updateBookings:async a=>{var o;let e=a.booking;const s=e.game_session.start.slice(0,10);e.id===((o=t.selected)==null?void 0:o.id)&&(e=await c(e.id),t.selected=e),y.name==="table"&&s>=t.arenaDate&&(e=await c(e.id),t.bookings=t.bookings.filter(r=>r.id!==e.id),t.bookings.push(e)),y.name==="index"&&s===t.selectedDate&&(a.update_timeline?await S():(e.status||(e=await c(e.id)),t.games.forEach(r=>{r.id===e.gameId&&r.bookings.forEach(n=>{n.id===e.id&&(n.status.value=e.status,n.status.label=e.status_desc,n.statusColor=l[e.status],n.payment=e.order.pay_info.paid,n.amount_with_discount=e.order.pay_info.total,n.payStatus=n.payment>0?n.amount_with_discount-n.payment>0?3:n.status.value===2?2:1:0,n.payStatusColor=l[n.payStatus])})})))},getArenaGamesByCities:p,setLocation:C,getArenas:I,getInfoArena:A,getTarifGame:D,getTarifGameNextMounth:G}});export{F as u};
